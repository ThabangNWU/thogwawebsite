<!-- Order.html Thymeleaf template -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Thogwa Medicals: Shop</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" type="img/Thogwa medicals project/Thogwa Medicals logo .jpg" href="/img/images/medical-logo.jpg">

    <!-- Place favicon.ico in the root directory -->


    <!-- Vendor CSS Files -->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
    <!-- <link href="assets/vendor/boxicons/css/boxicons.min.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.snow.css" rel="stylesheet">
    <link href="assets/vendor/quill/quill.bubble.css" rel="stylesheet">
    <link href="assets/vendor/remixicon/remixicon.css" rel="stylesheet">
    <link href="assets/vendor/simple-datatables/style.css" rel="stylesheet"> -->
    <!-- CSS here -->
    <link rel="stylesheet" th:href="@{'css/bootstrap.min.css'}">
    <link rel="stylesheet" th:href="@{'css/animate.min.css'}">
    <link rel="stylesheet" th:href="@{'css/magnific-popup.css'}">
    <link rel="stylesheet" th:href="@{'css/fontawesome-all.min.css'}">
    <link rel="stylesheet" th:href="@{'css/owl.carousel.min.css'}">
    <link rel="stylesheet" th:href="@{'css/nice-select.css'}">
    <link rel="stylesheet" th:href="@{'css/jquery-ui.css'}">
    <link rel="stylesheet" th:href="@{'css/odometer.css'}">
    <link rel="stylesheet" th:href="@{'css/aos.css'}">
    <link rel="stylesheet" th:href="@{'css/slick.css'}">
    <link rel="stylesheet" th:href="@{'css/default.css'}">
    <link rel="stylesheet" th:href="@{'css/style.css'}">
    <link rel="stylesheet" th:href="@{'css/responsive.css'}">
    <link rel="stylesheet" th:href="@{'css/login.css'}">

    <!-- Template Main CSS File -->
    <!-- <link href="assets/css/style.css" rel="stylesheet"> -->
</head>
<body>
<!-- header-area -->
<div class="header-top">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <div class="header-top-area">
                    <div class="header-top-left-text">
                        <p>We provides <span>best</span> medical accessories</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="header-top-right-text">
                    <ul>
                        <li><a th:href="@{/about-us}">About Us</a></li>
                        <li><a th:href="@{/contact}">Contact</a></li>
                        <li><a th:href="@{/contact}">FAQ</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="sticky-header" class="menu-area">
    <div class="container">
        <div class="mobile-nav-toggler"><i class="fas fa-bars"></i></div>
        <div class="menu-wrap">
            <nav class="menu-nav">
                <div class="row align-items-center">
                    <div class="col-lg-5 d-none d-lg-block">
                        <div class="navbar-wrap main-menu d-none d-lg-flex">
                            <ul class="navigation">
                                <li><a th:href="@{/}">Home</a></li>
                                <li class="menu-item-has-children"><a href="#">Pages</a>
                                    <ul class="sub-menu">
                                        <li><a th:href="@{/about-us}">About Us</a></li>

                                        <li><a th:href="@{/contact}">Contact Us</a></li>
                                        <li><a th:href="@{/latest-News}">Latest News</a></li>
                                    </ul>
                                </li>
<!--                                <li><a th:href="@{/product}">Shop</a></li>-->
                                <!-- <li class="active menu-item-has-children"><a href="shop.html">Shop</a> -->
                                <ul class="sub-menu">

                                </ul>
                                </li>
                                <li><a th:href="@{/login}">Sign In</a></li>

                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-2 col-md-3">
                        <div class="logo">
                            <a th:href="@{/}">
                                <img th:src="@{'/img/Thogwa medicals project/Thogwa Medicals logo .jpg'}" alt="">
                            </a>
                        </div>
                    </div>
                    <div class="col-lg-5 col-md-9">
                        <div class="header-action">
                            <ul>
                                <li class="header-search">
                                    <form th:action="@{/product/search}" method="get">
                                        <button type="submit"><i class="fas fa-search"></i></button>
                                        <input type="text"  name="name" placeholder="Search for products" th:value="${name}">
                                    </form>
                                </li>
                                <!--                                            <li class="header-user d-none d-md-block">-->
                                <!--                                                <a href="/contact"><i class="far fa-user"></i></a>-->
                                <!--                                            </li>-->
                                <li class="header-user d-none d-md-block">

                                    <a class=" d-none d-md-block" href="#" data-bs-toggle="dropdown">
                                        <i class="far fa-user"></i>
                                    </a><!-- End Profile Iamge Icon -->

                                    <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile">
                                        <!--                                                    <li class="dropdown-header">-->
                                        <!--                                                        <h6>Kevin Anderson</h6>-->
                                        <!--                                                        <span>Web Designer</span>-->
                                        <!--                                                    </li>-->
                                        <!--                                                    <li>-->
                                        <!--                                                        <hr class="dropdown-divider">-->
                                        <!--                                                    </li>-->

                                        <li>
                                            <a class="dropdown-item d-flex align-items-center" th:href="@{/thogwa-order}">
                                                <i class="bi bi-person"></i>
                                                <span>Your Orders</span>
                                            </a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <li>
                                            <a class="dropdown-item d-flex align-items-center" href="users-profile.html">
                                                <i class="bi bi-gear"></i>
                                                <span>Account Settings</span>
                                            </a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <li>
                                            <a class="dropdown-item d-flex align-items-center" href="pages-faq.html">
                                                <i class="bi bi-question-circle"></i>
                                                <span>Need Help?</span>
                                            </a>
                                        </li>
                                        <li>
                                            <hr class="dropdown-divider">
                                        </li>

                                        <li>
                                            <a class="dropdown-item d-flex align-items-center" href="#">
                                                <i class="bi bi-box-arrow-right"></i>
                                                <span>Sign Out</span>
                                            </a>
                                        </li>

                                    </ul><!-- End Profile Dropdown Items -->
                                </li><!-- End Profile Nav -->
                                <li class="header-shop-cart d-none d-md-flex">
                                    <a href="#">
                                        <img src="img/icon/shape-img.png" alt="">
                                        <span class="cart-count">0</span>
                                    </a>
                                    <span class="cart-price">R0.00</span>
                                    <ul id="minicart" class="minicart"  style="overflow-y: auto; max-height: 627.725px;">

                                    </ul>
                                </li>

                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
        <!-- Mobile Menu  -->
        <div class="mobile-menu">
            <nav class="menu-box">
                <div class="close-btn"><i class="fas fa-times"></i></div>
                <div class="nav-logo"><a th:href="@{/}"><img th:src="@{'/img/logo/Thogwa Medicals logo .jpg'}" alt="" title=""></a>
                </div>
                <div class="menu-outer">
                    <!--Here Menu Will Come Automatically Via Javascript / Same Menu as in Header-->
                </div>
                <div class="social-links">
                    <ul class="clearfix">
                        <li><a href="#"><span class="fab fa-twitter"></span></a></li>
                        <li><a href="#"><span class="fab fa-facebook-square"></span></a></li>
                        <li><a href="#"><span class="fab fa-pinterest-p"></span></a></li>
                        <li><a href="#"><span class="fab fa-instagram"></span></a></li>
                        <li><a href="#"><span class="fab fa-youtube"></span></a></li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="menu-backdrop"></div>
        <!-- End Mobile Menu -->
    </div>
</div>
<div class="header-category d-none d-lg-block">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="header-category-wrap">
                    <div class="header-cat-list">
                        <ul>
                            <li th:each="header : ${headers}">
                                <a href="#" th:text="${header.name}"></a>
                                <div class="dropdown">
                                    <div class="row main-dropdown">
                                        <div class="col-md-4 box drop1">
                                            <ul th:if="${header.id == selectedHeaderId}" th:each="category : ${categories}">
                                                <li>
                                                    <a href="#" th:text="${category.name}"></a>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </li>
                        </ul>



                    </div>
                    <div class="header-category-btn">
                        <a href="/shop">GET 5% OFF NOW</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</header>
<!-- header-area-end -->

<section class="section order">
    <div class="row">
        <div class="col-lg-12">
            <div class="modal" tabindex="-1" role="dialog" data-toggle="modal" data-target="#deleteModal">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Confirm delete</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <p>Are you sure you want to delete this record?</p>
                        </div>
                        <div class="modal-footer">
                            <a href="" class="btn btn-primary" id="delRef">Yes, Delete</a>
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-12">

                    <div class="card top-selling overflow-auto">

                        <div class="filter">
                            <a class="icon" href="#" data-bs-toggle="dropdown"><i class="bi bi-three-dots"></i></a>
                            <ul class="dropdown-menu dropdown-menu-end dropdown-menu-arrow">
                                <li class="dropdown-header text-start">
                                    <h6>Filter</h6>
                                </li>

                                <li><a class="dropdown-item" href="#">Today</a></li>
                                <li><a class="dropdown-item" href="#">This Month</a></li>
                                <li><a class="dropdown-item" href="#">This Year</a></li>
                            </ul>
                        </div>

                        <!-- <div class="card-body pb-0"> -->
<!--                            <h5 class="card-title">Top Selling <span>| Today</span></h5>-->
<!--                            <a th:href="@{/products}" class = "btn btn-primary">Add Product</a>-->
<!--                            <p th:if="${totalItems <= 0} ">No Products</p>-->
<!--                            <div th:if = "${success}" class = "text-center alert alert-success">-->
<!--                                <p th:text = "${success}"></p>-->
<!--                            </div>-->
<!--                            <div th:if = "${error}" class="text-center alert alert-danger">-->
<!--                                <p th:text = "${error}"></p>-->
<!--                            </div>-->


                            <table class="table table-borderless" >
                                <thead>
                                <tr>
                                    <th scope="col">Preview</th>
                                    <th scope="col">Product Name</th>
                                    <th scope="col">Order Quantity</th>
                                    <th scope="col">Order Status</th>
                                    <th scope="col">Total price</th>
                                    <th scope="col">Ordered Date</th>
                                    <th scope="col">Delivery Date</th>
                                </tr>
                                </thead>
                                <tbody >
<!--                                <tr th:text = "${address}"></tr>t-->
                                <tr th:each="order : ${orders}">
                                    <th scope="row"><a href="#"> <img th:src="@{/images/{imageName}(imageName=${order.productImageName})}" alt=""></a></th>
                                    <td><a href="#" class="text-primary fw-bold" th:text="${order.productName}"></a></td>
                                    <td th:text="${order.quantity}"></td>
<!--                                    <tr th:each="address, addressStat : ${shippingAddresses}">-->
<!--                                        &lt;!&ndash; Display order ID &ndash;&gt;-->
<!--                                        <td th:text="${addressStat.index + 1}">Order ID</td>-->
<!--                                        &lt;!&ndash; Display shipping address &ndash;&gt;-->
<!--                                        <td th:text="${address.street}, ${address.city}, ${address.state}, ${address.zipCode}">Shipping Address</td>-->
<!--                                    </tr>-->
                                    <td class="fw-bold" th:text=" ${order.orderStatus}"></td>
                                    <td  class="fw-bold" th:text="'R' + ${order.totalPrice}"></td>
                                    <td th:text="${order.orderDate}"></td>
                                    <th:block th:if="${order.deliveryDate == null}">
                                        <td >Pending</td>
                                    </th:block>
                                    <th:block th:if="${order.deliveryDate != null}">
                                        <td th:text="${order.deliveryDate}"></td>
                                    </th:block>
                                    <td>
                                        <th:block th:if="${order.deliveryDate == null}">
                                            <a th:href="@{/cancel-order (id = ${order.id})}" class="button-cancel">Cancel</a>
                                        </th:block>

                                    </td>
<!--                                    <td>-->
<!--                                        <div class="btn-group">-->
<!--                                            <a  id="specialPrice" th:href="@{/specialPrice/{id}(id= ${product.productId})}"><i class="bi bi-gift" ></i> </a>-->
<!--                                            <a th:href="@{/update-product/{id}(id= ${product.productId})}" ><i class="bi bi-pencil" style="padding-inline-end:20px;"></i> </a>-->
<!--                                            <a  id="deleteButton" th:href="@{/product/delete (id = ${product.productId})}"><i class="bi bi-trash" ></i> </a>-->

<!--                                        </div>-->
<!--                                    </td>-->
                                </tr>
                                </tbody>
                            </table>
                        <div class="shop-pagination">
                            <ul th:if="${totalPages != 1}">
                                <li th:class="${orders.number == 0} ? 'disabled'">
                                    <a class="pageLink" th:href="@{/thogwa-order(pageSize=${selectedPageSize}, page=1)}">&laquo;</a>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                </li>
                                <li th:class="${orders.number == 0} ? 'disabled'">
                                    <a class="pageLink" th:href="@{/thogwa-order(pageSize=${selectedPageSize}, page=${orders.number})}">&larr;</a>
                                </li>
                                <li th:class="${orders.number == (page - 1)} ? 'active pointer-disabled'"
                                    th:each="page : ${#numbers.sequence(pager.startPage, pager.endPage)}">
                                    <a class="pageLink" th:href="@{/thogwa-order(pageSize=${selectedPageSize}, page=${page})}"
                                       th:text="${page}"></a>
                                </li>
                                <li th:class="${orders.number + 1 == orders.totalPages} ? 'disabled'">
                                    <a class="pageLink"
                                       th:href="@{/thogwa-order(pageSize=${selectedPageSize}, page=${orders.number + 2})}">&rarr;</a>
                                </li>
                                <li th:class="${orders.number + 1 == orders.totalPages} ? 'disabled'">
                                    <a class="pageLink"
                                       th:href="@{/thogwa-order(pageSize=${selectedPageSize}, page=${orders.totalPages})}">&raquo;</a>
                                </li>
                            </ul>
                        </div>

                    </div>
                    </div>
                </div><!-- End Top Selling -->
            </div>
        </div>
        <!-- Top Selling -->

    </div>
</section>
<script src="assets/vendor/apexcharts/apexcharts.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/chart.js/chart.umd.js"></script>
<script src="assets/vendor/echarts/echarts.min.js"></script>
<script src="assets/vendor/quill/quill.min.js"></script>
<script src="assets/vendor/simple-datatables/simple-datatables.js"></script>
<script src="assets/vendor/tinymce/tinymce.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>

<!-- Template Main JS File -->
<script src="assets/js/main.js"></script>
<script type="text/javascript" src="../static/admin/assets/js/country.js" th:src="@{/admin/assets/js/product.js}"></script>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://kit.fontawesome.com/5dd83d6fa5.js" crossorigin="anonymous"></script>

<script>
    fetch('/product/random/category')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {

            populateShopItems(data);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });

    function populateShopItems(data) {

        const shopContainer = document.querySelector('.row .category-active .mb-70');

        t
        shopContainer.innerHTML = '';


        data.forEach(product => {
            const shopItemHTML = `
                <div class="col">
                    <div class="category-item">
                            <a href="shop.html">
                                <img src="img/products/${product.imageUrl}" alt="">
                                <span class="content">${product.name}</span>
                            </a>
                    </div>
                </div>
            `;


            shopContainer.innerHTML += shopItemHTML;
        });
    }
</script>
<script th:inline="javascript">
    var cartData = localStorage.getItem('order');
    if (cartData) {
        cartData = JSON.parse(cartData);
        console.log(cartData);
    }

    function displayCart() {
        var minicart = document.getElementById('minicart');
        var cartCount = document.querySelector('.cart-count');
        var cartPrice = document.querySelector('.cart-price');
        console.log();
        minicart.innerHTML = '';
        var totalQuantity = 0;
        var totalPrice = 0;

        cartData.forEach(function(item) {
            var listItem = document.createElement('li');
            listItem.classList.add('d-flex', 'align-items-start');


            var totalItemPrice = parseFloat(item.product) * parseInt(item.quantity);

            listItem.innerHTML = `
                <div class="cart-img">
                    <a href="#"><img src="/img/products/${item.productImageName}" alt=""></a>
                </div>
                <div class="cart-content">
                    <h4><a href="#">${item.productName}</a></h4>
                    <div class="cart-price">
                        <span class="new">R${item.product} x ${item.quantity}</span>
                        <span>Total: R${totalItemPrice.toFixed(2)}</span>
                    </div>
                </div>
                <div class="del-icon">
                    <a href="#" onclick="deleteItem('${item.productID}')"><i class="far fa-trash-alt"></i></a>
                </div>
            `;

            minicart.appendChild(listItem);

            totalQuantity += parseInt(item.quantity);
            totalPrice += totalItemPrice;
        });


        var totalItem = document.createElement('li');
        totalItem.innerHTML = `
            <div class="total-price">
                <span class="f-left">Total:</span>
                <span class="f-right">R${totalPrice.toFixed(2)}</span>
            </div>
        `;

        var checkoutItem = document.createElement('li');
        checkoutItem.innerHTML = `
            <div class="checkout-link">
                <a href="#">Shopping Cart</a>
                <a class="black-color" th:href=@"{/checkout}" id="checkoutLink">Checkout</a>
            </div>
        `;

        minicart.appendChild(totalItem);
        minicart.appendChild(checkoutItem);


        cartCount.textContent = totalQuantity;
        cartPrice.textContent = `R${totalPrice.toFixed(2)}`;
    }

    displayCart();

    function deleteItem(productID) {

        let index = cartData.findIndex(item => item.productID === productID);


        if (index !== -1) {
            cartData.splice(index, 1);


            localStorage.setItem('order', JSON.stringify(cartData));


            displayCart();
        }
    }

</script>
<script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function() {
            let cartItems = localStorage.getItem('order');
            if (cartItems) {
                let parsedCartItems = JSON.parse(cartItems);
                console.log('Parsed Cart Items:', parsedCartItems.productID);

                fetch('/add-to-order', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(parsedCartItems)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Cart items saved successfully:', data);
                })
                .catch(error => {
                    console.error('There was a problem with the fetch operation:', error);
                });
            }
        });
    </script>

</body>
</html>
